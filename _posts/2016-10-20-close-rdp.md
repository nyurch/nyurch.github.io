---
layout: post
title: Боротьба з незакритими RDP-сеансами.
category: [WINDOWS]
---
![RDP logo](/media/Remote-Desktop-Connection-Manager.png?style=head)  
Як правило людці просто закривають вікно rdp-сеансу, замість того щоб розлогінитися. Сам такий. В результаті при	неналаштованих групових політиках рано чи пізно хтось не зможе зайти поки не будуть примусово відключені інші сеанси. Автоматично вирішити	проблему можна налаштувавши **GPO**, або запускаючи відключення за розкладом.<!--more-->Перший варіант очевидно більш пристойний, але не прийнятний для несерверних ОС бо там навіть при встановленому **adminpack** немає консолі ***Terminal Services Configuration***.
Отже варіант **GPO** та варіант відключення за розкладом:
1. Відкриваємо консоль ***Terminal Services Configuration***, переходимо в розділ *Connections* і дивимося властивості **RDP-Tcp**, конкретно закладку **Sessions** і виставляємо бажаний час для параметрів **End a disconnected session**, **Active session limit** та **Idle session limit**.	Налаштування не будуть застосовані до активних на даний момент сесій.
2. Створюємо cmd-файл з наступним змістом:
    {% highlight console %}FOR /L %%i IN (0,1,9) DO echo Y | rwinsta %%i /Server:назва_сервера{% endhighlight %}
Тут використано те що **id** кожній сесії присвоюються за порядком від 0 і далі, тому такий варіант просто відключає сесії з **id** від 0 до 9. Можна ускладнити визначаючи **id** лише для певних	юзерів записаних у текстовий файл, а потім відключаючи лише їх. Далі додаємо файл в планувальник завдань і виконуємо наприклад кожного дня після закінчення робочого часу.
