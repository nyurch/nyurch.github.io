---
layout: post
title: Обробка тексту та графіки.
category: [WEB]
---
		<img class="head" src="/media/site-building.png" alt="">
		<p>Конспект за результатами переходу від старого до нового сайту. Пакетна і одинична обробка текстових та графічних документів. Слідами виконаних робіт згрібаю все в купу.<!--more--><br>
		Взяти вказаний html-файл, прибити там всі html-теги і зберегти результат у текстовому файлі:</p>
		<xmp class="bsh">sed -e :a -e 's/&lt;[^&gt;]*&gt;//g;/&lt;/N;//ba' file.html &gt; file.txt</xmp>
		<p>Додати в кінці кожного рядка вказаного файлу &lt;br&gt;. Після дня з бубном довелося використати vi у неекранному режимі(ex-mode command) бо ні sed, ні awk, хоч ти трісни, вставляли на початок рядка, причому із заміною. Хоча у іншому проекті пару років тому варіант <i class="code">sed 's/$/ла-ла-ла/'</i> прекрасно справлявся з задачею дописувати текст в кінець рядка і саме такий варіант всюди описаний в інтернетах.</p>
		<xmp class="bsh">ex +"%s/$/&lt;br&gt;/g" -cwq data_file_1.txt</xmp>
		<p>Вирізати в кожному рядку файлу даних 3,4,5 символ та перезаписати дані в інший файл, потім витерти всі символи після 35го та записати результат у 3й файл:</p>
		<xmp class="bsh">cat data_file_1.txt | cut --complement -b '3-5' &gt; data_file_2.txt
cat data_file_2.txt | cut --complement -b 35- &gt; data_file_3.txt</xmp>
		<p>Видалити всі пробіли в кінці рядків:</p>
		<xmp class="bsh">sed -i 's/ *$//' data_file_4.txt</xmp>
		<p>В деяких випадках коли треба потерти щось з кінця рядків неоднакової довжини варіант  <i class="code">cut --complement -b</i> не підходить і використовується варіант з оберненням напрямку рядка, видаленням і оберненням назад. На прикладі видалення 9 останніх символів кожного рядка:</p>
		<xmp class="bsh">rev data_file_5.txt  | cut -c 9- | rev</xmp>
		<p>Так був вибраний і перебраний корисний контент із сайту бородатих років та підготовлений до використання деякий абсолютно новий. Побічним завданням сумнівної необхідності було перегнати купу графіки під варіант однакової ширини зі збереженням пропорцій. У даному випадку ширина 256px:</p>
		<xmp class="bsh">for i in *.png; do convert -verbose -quality 80 -resize 256x $i $i; done
for i in *.jpg; do convert -verbose -quality 80 -resize 256x $i $i; done
for i in *.jpeg; do convert -verbose -quality 80 -resize 256x $i $i; done
for i in *.gif; do convert -verbose -quality 80 -resize 256x $i $i; done</xmp>
		<p>І ще більш сумнівної необхідності операція конвертації svg у png. Для цього ще треба доставити одну бібліотеку:</p>
		<xmp class="bsh">sudo apt-get install librsvg2-bin</xmp>
		<p>в результаті можемо піддивитися <i class="code">rsvg-convert --help</i>. Використовуємо так:</p>
		<xmp class="bsh">for i in *.svg; do rsvg-convert $i -a -w 256 -o `echo $i | sed -e 's/svg$/png/'`; done</xmp>
		<p>Є не зовсім зрозумілий нюанс, якщо в директорії уже є png-файли вони чомусь також оброблювалися і ламалися. Якщо встановлений <term>Inkscape</term> то можна так:</p>
		<xmp class="bsh">for i in *; do inkscape $i --export-png=`echo $i | sed -e 's/svg$/png/'`; done</xmp>
		<p>або якщо треба переконвертити також у піддиректоріях то виориствуємо так:</p>
		<xmp class="bsh">find . -iname \*.jpg -exec convert -verbose -quality 80 -resize 256x "{}" "{}" \;</xmp>
		<p>Ну і в кінці допилюємо до пристойного вигляду сам html-код:</p>
		<xmp class="bsh">tidy -i -m -w 260 -ashtml -utf8 index.html</xmp>
		<p>Тут ще один момент - система може містити <term>tidy</term> без підтримки <term>html5</term>, як моя <term>ubuntu 12.04</term>. Треба прибити встановлену і зібрати новий варіант з <term>github</term>:</p>
		<xmp class="bsh">sudo apt-get remove libtidy-0.99-0 tidy
sudo apt-get install git-core automake libtool
git clone https://github.com/w3c/tidy-html5cd tidy-html5/build/cmake&nbsp;
cmake ../.. -DCMAKE_BUILD_TYPE=Release
sudo make install</xmp>
		<p>далі ще ніби треба вставити у файл <path>/etc/ld.so.conf</path> рядок <path>/usr/local/lib</path> і виконати</p> <xmp class="bsh">sudo ldconfig</xmp> <p>але я здається цього не робив і все працює нормально, а інструкція хоч і писалася для <term>ubuntu 10.04/12.04</term> але після</p> <xmp class="bsh">git clone</xmp> <p>вже була не правильна, там далі вже мої правки.<br>
		А в результаті ще й довелося у всіх файлах перевести всі назви картинок до того ж вигляду що і назви файлів(в даному випадку в нижній регістр), вінді й апачу це до лампочки, але якщо вести роботу в лінуксі то не відображається графіка при неспівпадінні регістру.</p>
		<xmp class="bsh">for i in *.html; do sed -i '/src=\"logo/ s/[[:upper:]]/\L&amp;/g' $i $i; done</xmp>
		<p>Механізм наступний - sed шукає рядки в яких є входження&nbsp; logo/ і переводить весь рядок у нижній регістр, все знаходиться у циклі який проганяє всі html-файли в директорії. Якщо необхідно перевести все у верхній регістр то</p>
		<xmp class="bsh">for i in *.html; do sed -i '/src=\"logo/ s/[[:lower:]]/\U&amp;/g' $i $i; done</xmp>
