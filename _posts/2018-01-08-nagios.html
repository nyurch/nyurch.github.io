---
layout: post
title: Nagios - індустріальний стандарт моніторингу.
category: [ПРИКЛАДНІ ПРОГРАМИ]
---
<img class="head" src="/media/nagios.png" alt="">
<p><term>Nagios</term> - програма що служить для моніторингу програмного та апаратного
стану обладнання в локальних мережах і сповіщення адміністратора про
зміни їх статусу. Працює фактично на всіх <term>unix-системах</term>. Розглянемо
установку та початкове налаштування даної програми на прикладі
операційної системи <term>Ubuntu</term>.<!--more-->
Першим кроком встановлюємо необхідні пакети. У випадку базової
конфігурації це <term>apache</term>, <term>build-essential</b>, <term>libgd2-xpm-dev</term> та сам <term>nagios</term>.</p>
<xmp class="bsh">sudo apt-get install apache2 build-essential libgd2-xpm-dev nagios3</xmp>
<p>Далі створюємо віртуальний хост в <term>apache</term>. Для цього можна скористатися
шаблоном <b>default</b>, скопіюємо його під іменем <path>nagios</path> в ту ж теку та
змінимо його як нам потрібно:</p>
<xmp class="bsh">sudo cp /etc/apache2/sites-available/default /etc/apache2/sites-available/nagios</xmp>
<p>Готовий файл <b>nagios</b> можна забрати <a href="https://" target="_blank">тут</a>.
В даному файлі ми вказали що для доступу до сайту моніторингу ми будемо
використовувати порт <b>9000</b>, тому потрібно вказати на це нашому
веб-серверу додавши у файл <path>/etc/apache2/ports.conf</path> рядки</p>
<xmp class="lst">NameVirtualHost 192.168.7.234:9000
Listen 9000</xmp>
<p>Файли конфігурації nagios лежать у директорії <path>/etc/nagios3/</path>. У файлі
<path>nagios.cfg</path> підключаються інші конфіги й задаються налаштування. У файлі
<path>cgi.cfg</path> задаються налаштування cgi-скриптів і права доступу до сайту в
графічному інтерфейсі. Припустимо ім'я користувача системи моніторингу
буде nagios, тоді у файл <path>cgi.cfg</path> потрібно внести наступні зміни:</p>
<xmp class="lst">default_user_name=nagios
authorized_for_system_information=nagiosadmin,nagios
authorized_for_configuration_information=nagiosadmin,nagios
authorized_for_system_commands=nagiosadmin,nagios
authorized_for_all_services=nagiosadmin,nagios
authorized_for_all_hosts=nagiosadmin,nagios
authorized_for_all_services=nagiosadmin,nagios
authorized_for_all_hosts=nagiosadmin,nagios
authorized_for_all_service_commands=nagiosadmin,nagios
authorized_for_all_host_commands=nagiosadmin,nagios</xmp>
<p>Як бачимо при наявності двоч чи більше користувачів їх імена перераховуються через кому і без пробілів.
Тепер створюємо самого користувача <b>nagios</b> та задаємо для нього пароль:</p>
<xmp class="bsh">cd  /etc/nagios3/
sudo htpasswd -c htpasswd.users nagios</xmp>
<p>Нарешті перезапускаємо <b>nagios</b> та <b>apache</b></p>
<xmp class="bsh">sudo service nagios3 restart
sudo service apache2 restart</xmp>
<p>На даному етапі ми отримали готовий сервер моніторингу доступ до якого
можна отримати з веб-браузера за адресою <path>http://localhost:9000</path> або
<path>http://наш_ір:9000</path>
Кількість роботи яку потрібно провести надалі залежить виключно від кількості серверів та сервісів що ми збираємося моніторити.
<b>&lt;command&gt; --usage</b> - виклик опису параметрів команди, детальніше тут.
Зауважу ще дві речі котрі можуть в певній мірі допомогти пришвидшити процес конфігурації:</p>
<ol>
<li> Перевірити правильність змін зроблених нами в конфігурації nagios
можна виконавши команду
<xmp class="bsh">sudo  nagios3 -v  /etc/nagios3/nagios.cfg</xmp></li>
<li> Можна спробувати автоматизувати сканування хостів та сервісів у мережі програмою <term>ScanToNag</term> за шаблоном подібним до наступного
<xmp class="bsh">java -jar ScanToNag.jar --range 192.168.64.0/24 --range 192.168.62.0/24 --emit-templates --timeout 50 --contacts unix-admins --hosts-file hosts.conf --services-file services.conf --skip-reserved</xmp></li>
</ol>
