---
layout: post
title: Костилі для Windows 10. Оновлюється.
category: [WINDOWS]
---
		<img class="head" src="/media/windows_10.jpg" alt="">
		<p>Розгрібаємо результати розрідження мозку у індусів з Microsoft - виключаєм оновлення драйверів, кожне друге з яких призволить до смерті системи, повертаємо працездатність
кнопки F8 у процесі завантаження, змінюємо положення директорії Users та повертаємо функціонал адміністративних мережевих ресурсів.<!--more--></p>
		<h4>wushowhide</h4>
		<p>Як виявилося дебілізм свого рішення із забороною приховувати оновлення які можуть призводити до краху системи розуміють навіть індуси із MS. А тому існує абсолютно офіційна утиліта що таки дозволяє це робити. Зветься <a href="https://support.microsoft.com/uk-ua/kb/3073930" target="_blank">wushowhide</a>. Костиль різний, для різних версій і збірок, так що навіть тут треба обережно.</p>
		<h4><b class="warning">!!!</b> Administrative share</h4>
		<p>Виявляється починаючи із <term>Win8</term>(?) за замовчуванням закрито доступ до шар типу <path>c$</path>. Ідіотизм рішення також більш ніж очевидний тому офіційна інструкція як його повернути присутня. Треба в гілці реєстру <path>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</path> створити новий <term>DWORD-параметр</term> з іменем <path>LocalAccountTokenFilterPolicy</path> і присвоїти йому значення <b>1</b>.</p>
<p class="warning">!!! Для Windows 10 втратило актуальність після літніх апдейтів 2017 року.</p>
		<h4>F8</h4>
		<p>Я може чогось недорозумію, але за весь час існування Windows 8 і новіших я все ніяк не можу зрозуміти якому наркоману після лоботомії прийшла в голову ідея заблокувати функцію клавіші F8 в процесі завантаження системи. На щастя повертається на місце все досить просто.</p>
		<ol>
	    <li>У розділі <path>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Configuration Manager</path> створюємо <term>DWORD-параметр BackupCount</term> і присвоюємо йому значення рівне бажаній кількості бекапів гілки <path>CurrentControlSet</path>. Рекомендують <b>2</b>, не буду сперечатися.</li>
		<li>У цьому ж розділі створюємо підрозділ <path>LastKnownGood</path>, а в ньому <term>DWORD-параметр Enabled</term> зі значенням <b>1</b>.</li>
		<li>На останок розблоковуємо спрацювання клавіші <term>F8</term><xmp class="bsh">bcdedit /set "{current}" bootmenupolicy legacy</xmp></li>
		</ol>
		<h4>Переміщення директорії Users в процесі встановлення</h4>
		<p>Для переміщення директорії з профілями користувачів у процесі встановлення потрібно на етапі вибору стандартних параметрів перейти в режим аудиту(CTRL+SHIFT+F3). Комп'ютер перезавантажується і запускає <term>sysprep</term>.</p>
		<ol>
	    <li>Закриваємо <term>sysprep</term>;</li>
		<li>Створюємо файл <term>relocate.xml</term> такого виду. В даному випадку архітектура <term>amd64</term> та новий шлях до профілів <path>d:\Users;</path></li>
		<li>Копіюємо файл в корінь будь-якого диску;</li>
		<li>Запускаємо командний рядок від імені адміністратора:
		<ul><li>впевнюємося що вимкнена служба <term>WMPNetworkSvc</term>
		<xmp class="bsh">net stop wmpnetworksvc</xmp></li>
		<li>запускаємо sysprep з потрібними параметрами
		<xmp class="bsh">%windir%\system32\sysprep\sysprep.exe /oobe /reboot /unattend:d:\relocate.xml</xmp></li></ul></li>
		</ol>
		<p>Після перезавантаження продовжуємо встановлення системи.<br>Теоретично повинно працювати і на живій системі при виконанні пунктів <b>2-4</b>. Правда я після цього отримав зациклений перезапуск в режимі аудиту, можливо тому що система була вже не чиста.</p>
		<h4>Your user profile was not loaded correctly! You have been logged on with a temporary profile.</h4>
		<p>У <term>Win Vista+</term> якщо перейменувати/перенести профіль доменного користувача(локального теоретично також) то після перезавантеження він не створиться з нуля, як у <term>Win XP</term>, а завантажиться тимчасовий профіль. Ідіотизм рішення очевидний. Лікується видаленням бекапу гілки реєстру <path>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\S-1-5-...bak</path> у якій параметр <term>ProfileImagePath</term> вказує на директорію де знаходився видалений/переіменований профіль.</p>
		<h4>Відновлення завантажувача Windows 10.</h4>
		<ol>
	    <li>Завантажуємося з установочного диску Windows 10;</li>
		<li>Доходимо до етапу з кнопкою <term>Install Now</term> та натискаємо <term>Repair your computer</term>;</li>
<a rel="colorbox" href="/media/repair-10.jpg" >
     <img class="blog" src="/media/repair-10.jpg"  alt="">
</a>
		<li>Далі йдемо за пунктами <term>Troubleshoot/Advanced options/Command Prompt</term>;</li>
<a rel="colorbox" href="/media/repair-10-1.jpg" >
     <img class="blog" src="/media/repair-10-1.jpg"  alt="">
</a>
		<li>Виконуємо:
		<xmp class="bsh">Bootrec /fixMbr</xmp>
		<xmp class="bsh">Bootrec /fixBoot</xmp></li></ul></li>
		</ol>
		<h4>NumLock у Windows 10.</h4>
<p>Якщо система не вмикає при старті NumLock незважаючи ні на налаштування bios, ні на свої можна ще спробувати руками у гілці реєстру <path>HKEY_USERS\.Default\Control Panel\Keyboard</path> задати параметру <path>InitialKeyboardIndicators</path> значення <b>2</b>, значення за замовчуванням <b>0</b>. Це має увімкнути NumLock ще на етапі <b>logonscreen</b>.</p>
		</ol>
